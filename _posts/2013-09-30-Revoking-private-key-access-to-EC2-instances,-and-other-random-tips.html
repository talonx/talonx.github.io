---           
layout: post
title: Revoking private key access to EC2 instances, and other random tips
date: 2013-09-30 18:21:13 UTC
updated: 2013-09-30 18:21:13 UTC
comments: false
categories: amazon web services ec2
---
Consider the following scenario<br /><br /><ul><li>You have many EC2 instances running production code</li><li>Access to those instances is using a passphrase-protected  key</li><li>A member of your operations team who has access to the key leaves so you have to change the key. Or, you need to change the existing key as a matter of some internal security policy.</li></ul><br />How do you do it?<br /><br />You<br /><ul><li>Generate a new keypair</li><li>Add the public key to the EC2 instances' &lt;login user's home dir&gt;/.ssh/authorized_keys</li><li>Remove the old public key from the same authorized_keys file</li><li>Done. The old key is useless now.</li><li>This is not actually revocation</li></ul><br />Some things to note about AWS keypairs <br /><ul><li>EC2 metadata for the instance(s) will continue to show the original keypair name it was created with, whatever keys you add or remove from authorized_keys. The original public key may not even exist on the instance anymore, if you have gone through the steps above, but the metadata will still show it. This is because AWS has no way of knowing that you changed the authorized_keys file. </li><li>You can upload keys generated by yourself to the AWS console and they will be available for use while launching EC2 instances. Your generated keys have to be RSA keys of 1024, 2048 or 4096 bits.</li><li>AWS keypairs are said to be confined to a single region. This is true only if you consider the default state of affairs. You can get around it. </li><ul><li>For keys that you generate, you can&nbsp; import them to all the regions you want using the AWS console or the CLI tools.&nbsp;</li><li>For keys that AWS generates, you can take the public key from an EC2 instance launched with that key, and import that in a similar manner to all the regions you want. The private key is available for download when you generate the key.</li></ul></ul><br />