---           
layout: post
title: Instance Initializers in Java
date: 2010-05-23 08:47:47 UTC
updated: 2010-05-23 08:47:47 UTC
comments: false
categories: java programming
---
<div dir="ltr" style="text-align: left;" trbidi="on">Take a look at this simple code<br /><br /><span style="color: blue;">Code Snippet 1</span><br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">public class Init {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; System.out.println("In the beginning was the command line");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public Init()</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; System.out.println(&amp;quot;Created an instance&amp;quot;);</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public static void main(String[] args)</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; Init init = new Init();</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><br />What do you think the output is? It's this -<br /><pre>    In the beginning was the command line<br />    Created an instance</pre><br />The 'hanging' braces at the start of the class definition are instance initializers. Most of us are more familiar with static initializers -<br /><br /><span style="color: blue;">Code Snippet 2</span><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">static</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">{</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; //Do stuff</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</div><br /><br />Instance initializers (II) are not seen often in everyday Java code - so they might seem odd at first. They are executed every time an instance of that class is created, before the statements in the constructor are executed. (See <i>The Java Language Specification 3 </i>section 8.6).<br /><br />One use of IIs can be to execute something whenever an instance is created, and the class has multiple constructors, without calling it in every single constructor.<br />Another one which has become popular is populating collections during declaration, in the style of Ruby or Python single-line initializers -<br /><br /><span style="color: blue;">Code Snippet 3</span><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">private Set&lt;String&gt; names = new HashSet&lt;String&gt;() {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; add("Rigel");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; add("Vega");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; add("Antares");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">};</div><br /><br />This idiom was how I encountered IIs first while reading somebody's blog.<br />What is actually happening here?<br /><ol><li>An anonymous inner class is created.<br /> </li><li>An instance initializer block is added to the anon inner class.<br /> </li><li>Objects are added to the instance of that class when the names variable is initialized.</li></ol><br />Now take this scenario:<br /><br /><span style="color: blue;">Code Snippet4</span><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">public class WrongUsage {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; private Set&lt;String&gt; names;</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; add("pleiades");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public void WrongUsage()</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; names = new HashSet&lt;String&gt;();</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public void add(String name)</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; names.add(name);</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><br />Based on what we have seen above, the names set is used before it's initialized. So this throws a NullPointerException.<br />Let's take another case - similar to the above but involving inheritance.<br /><br /><span style="color: blue;">Code Snippet 5</span><br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">public class MyHashSet extends HashSet {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; add("pleiades");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; System.out.println("Added");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public MyHashSet()</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; super();</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; System.out.println("After calling super");</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; public static void main(String[] args)</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; {</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; Set set = new MyHashSet();</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</div><br /><br />This runs, with the output being<br /><pre>    Added<br />    After calling super</pre><br />In this case, add() internally uses the inner HashMap inside HashSet which is initialized in the HashSet constructor. This implies that the instance initializer is invoked before the class constructor, but after the superclass constructor (The super call is redundant here. It will be called anyway).<br /><br />So the sequence is <br /><ol><li> Superclass initialization (this includes superclass instance initializers and constructor)<br /> </li><li> Current class's Instance initializers<br /> </li><li> Current class's Constructor</li></ol><br />This is why the code in Code Snippet 3 does not throw an NPE - because it's a case of inheritance (the anon inner class is a subclass of HashSet)</div>