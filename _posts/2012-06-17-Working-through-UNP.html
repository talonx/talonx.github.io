---           
layout: post
title: Working through UNP
date: 2012-06-17 08:36:59 UTC
updated: 2012-06-17 08:36:59 UTC
comments: false
categories: c network programming programming
---
As I wrote <a href="http://code.deepinspace.net/2010/11/23/falling-through/" target="_blank">previously</a>, I've been working through Richard Stevens' Unix Network Programming (3rd Ed) Vol 1. It covers the basics of the Sockets API in UNIX and similar OSs.<br/><br/>Unfortunately I've been able to devote time for this mostly on the weekends. This translates to slow progress because UNP goes into a lot of depth about everything. This is a good thing, but it also means that I've to reread and review the last few pages everytime I try to pick up where I left off. This does not really help when I'm trying to understand concepts in depth. So what's the solution? I'll try to do a bit atleast 3-4 days a week from now on.<br/><br/>UNP is an amazingly detailed book - and as one of my colleagues said - "If you read that book properly, Stevens makes sure that there's nothing left for you to know on the topic". I agree.<br/><br/>Stevens wrote his own wrapper functions over common socket functions and used them in all the code examples in the book. The wrappers handle all error codes and portability issues (like IPv4/IPv6). These are included in a header unp.h (available in the back of the book as well as online on <a href="http://www.unpbook.com/src.html">http://www.unpbook.com/src.html</a>).<br/><br/>Some reviewers of the book gripe about this and say that this is an obstacle to learning the actual functions. But I think that there was no other way to do it without littering every example snippet with code for portability and error handling. The wrapper strategy makes it easier to follow the examples, and at the same time - as I found out - it makes you write those wrappers yourself. True, you can just include the unp.h header as you try the examples, but then you'll never know what those functions are doing. I've found that creating my own header and writing the functions as I come across them, after looking at the book's source code, works great. Most of them will end up identical to those in unp.h.<br/><br/>I'm pushing the examples I'm trying out into <a href="https://github.com/talonx/C-Scribbles/tree/master/net">github</a> - it's a scratchpad so not everything might compile.<br/><br/>I've added a generic <a href="https://github.com/talonx/C-Scribbles/blob/master/net/mynet.h">startserver function</a> to my header - this takes a pointer to a function as an argument. The generic function starts a server socket (bind/listen/accept), forks a child when a client connects and calls the function that was earlier passed as an argument, abstracting out the actual serving part. The function pointer syntax was not hard to figure out - I'd read <a href="http://www.amazon.com/Expert-Programming-Peter-van-Linden/dp/0131774298">Peter van der Linden</a>'s algo on unscrambling declarations in C last week. Interesting how things add up!