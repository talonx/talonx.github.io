---           
layout: post
title: "Graphite Tip: Disabling data averaging while viewing graphs"
date: 2013-11-23 18:16:27 UTC
updated: 2013-11-23 18:16:27 UTC
comments: false
categories: graphite monitoring
---
<span style="font-family: Arial,Helvetica,sans-serif;"><a href="http://graphite.readthedocs.org/en/latest/" target="_blank">Graphite</a>, the superb graphing tool, has gained a lot of popularity lately and with good reason. It's flexible, fairly easy to setup, very easy to use and has a thriving community with plugins for many monitoring systems. It can store any kind of numeric data over time.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">By default, Graphite stores data in WhisperDB, a fixed size database with configurable retention periods for various resolutions. What this means is that you can store higher resolution data (say data for every 5 seconds) for a shorter period of time (e.g. 1 month) and then store the same data at the lower resolution (say for every hour) beyond that time period. The data will be consolidated based on the the method you configure (sum, average). This behaviour of Graphite is well known.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">What is not so well known is that Graphite also does consolidation when you view the graphs. This happens when the number of data points is more than the number of pixels. In such cases, the Graphite graph renderer will consolidate the data into one point using an aggregation function. The default aggregation function is <i>average</i>. So you might end up <a href="https://answers.launchpad.net/graphite/+question/199322" target="_blank">seeing smaller values</a> than you expect.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">Here's an example of a graph where there are more data points than pixels. The actual peak value was a little over 200, but you cannot see it here due to averaging.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: Arial,Helvetica,sans-serif;"><a href="http://2.bp.blogspot.com/-yOpFBEMHrGY/UpDusD3UREI/AAAAAAAAABk/T8etaWphz9s/s1600/normal-average.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-yOpFBEMHrGY/UpDusD3UREI/AAAAAAAAABk/T8etaWphz9s/s1600/normal-average.png" /></a></span></div><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><br /><span style="font-family: Arial,Helvetica,sans-serif;">Here is the same graph (same data for the time span) where the image width has been increased<b>*</b> (== more pixels). You can see the peak is almost 200. </span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-GU3hLLTMakY/UpDuzemL28I/AAAAAAAAABs/d55T96EuGr4/s1600/widened-average.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="66" src="http://3.bp.blogspot.com/-GU3hLLTMakY/UpDuzemL28I/AAAAAAAAABs/d55T96EuGr4/s640/widened-average.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Click to view larger</td></tr></tbody></table><br /><span style="font-family: Arial,Helvetica,sans-serif;">Sometimes this behaviour may not be what you want. To see the "actual" data points irrespective of what size your image is, Graphite's URL API provides a property called minXStep. To use it simply add the property as a request parameter (with value 0) in the graph URL. From the <a href="https://graphite.readthedocs.org/en/latest/render_api.html#minxstep" target="_blank">documentation</a>:</span><br /><span style="font-family: Arial,Helvetica,sans-serif;">&nbsp;<span style="font-size: x-small;"><i>&nbsp;</i></span></span><br /><blockquote class="tr_bq"><span style="font-family: Arial,Helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-size: small;"><i>To disable render-time point consolidation entirely, set this to <span class="docutils literal"><span class="pre">0</span></span> though note that series with more points than there are pixels in the graph area (e.g. a few month’s worth of per-minute data) will look very ‘smooshed’ as there will be a good deal of line overlap.</i> </span></span></span></blockquote><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">The same graph with minXStep=0 now looks like this:</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-deLBQCTkwok/UpDvU9NkvnI/AAAAAAAAAB0/49kP76PFerc/s1600/normal-xstep.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-deLBQCTkwok/UpDvU9NkvnI/AAAAAAAAAB0/49kP76PFerc/s1600/normal-xstep.png" /></a></div><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">A bit "smooshed" but with the exact data that was collected.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /><i><span style="font-size: x-small;"><b>*</b> Pass width=x as a request parameter to the graph URL, x in pixels</span></i></span>
